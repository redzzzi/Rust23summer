# ğŸ“œ 09 Error Handling
[panic!](#1-unrecoverable-errors-with-panic)&emsp;[Result](#2-recoverable-errors-with-result)&emsp;[panic!â­•âŒ](#3-to-panic-or-not-to-panic)
<br><br>

## 1. Unrecoverable Errors with panic!ğŸ¤¯

### ```panic!```
* íŒ¨ë‹‰ì´ ë°œìƒí•˜ë©´ í”„ë¡œê·¸ë¨ì€ ë§ì€ ì¼ì„ í•¨ (ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥ â†’ ìŠ¤íƒ ë˜ê°ê³  ì²­ì†Œí•˜ê¸° â†’ ì¢…ë£Œ)
* ì•„ë˜ ì„¤ì •ì„ í†µí•´ *ê·¸ë§Œë‘ê¸°*ë¥¼ ì„¤ì •í•˜ì—¬ ```build``` ì‹œì— ë˜ê°ê¸°ê°€ ì•„ë‹Œ ê·¸ë§Œë‘ê¸°ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŒ
  <br>

  ```rust
  // Cargo.toml íŒŒì¼ ì¶”ê°€ ë‚´ìš©
  [profil.release]
  panic = 'abort'
  ```
  <img src="https://github.com/redzzzi/Rust23summer/assets/127263392/5c225a1f-1bde-47c1-ac6b-2234bd8a5c30" width="700px"><br>
    * panic! ë°œìƒí•œ ë¶€ë¶„ì— ëŒ€í•œ ì„¤ëª…ì´ ìˆìŒ
---
### panic! ë°±íŠ¸ë ˆì´ìŠ¤ ì‚¬ìš©
* *backtrace*: ì–´ë–¤ ì§€ì ì— ë„ë‹¬í•˜ê¸°ê¹Œì§€ í˜¸ì¶œí•´ì˜¨ ëª¨ë“  í•¨ìˆ˜ì˜ ë¦¬ìŠ¤íŠ¸
* ```RUST_BACKTRACE=1 cargo run``` ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¨ ì§€ì ì„ ìˆœì„œëŒ€ë¡œ ì°¾ì•„ê°ˆ ìˆ˜ ìˆìŒ
<br>

## 2. Recoverable Errors with Result
ğŸ’¡ [2ì¥] ```Result``` ì—´ê±°í˜•ì€ ```Ok```ì™€ ```Err``` ë‘ variantë¥¼ ê°–ëŠ”ë‹¤ğŸ’¡

### ```File::open``` í•¨ìˆ˜
* ë°˜í™˜ íƒ€ì„: ```Result<T, E>```
* íŒŒì¼ ì—´ê¸° ì½”ë“œ
  <br>

  ```rust
  use std::fs::File;

  fn main() {
      let f = File::open("hello.txt");
  }
  ```
* ```match``` í‘œí˜„ì‹ì„ ì´ìš©í•˜ì—¬ ```Result``` ì²˜ë¦¬í•˜ê¸°
  <br>

  ```rust
  use std::fs::File;

  fn main() {
      let f = File::open("hello.txt");
  
      let f = match f {
          Ok(file) => file,  // File::openì´ ì„±ê³µí•˜ì—¬ Ok ì¸ìŠ¤í„´ìŠ¤ ì „
          Err(error) => {
              panic!("There was a problem opening the file: {:?}", error)
          },
      };
  }
  ```
  ```rust
  // hello.txt íŒŒì¼ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
  thread 'main' panicked at 'There was a problem opening the file: Os { code: 2, kind: NotFound, message: "No such file or directory" }', src/main.rs:9:13
  ```
<br>

### ì„œë¡œ ë‹¤ë¥¸ ì—ëŸ¬ì— ëŒ€í•´ ë§¤ì¹­
```rust
use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let f = File::open("hello.txt");  // íŒŒì¼ ì—´ê¸° ì‹œë„, ê²°ê³¼ ë¦¬í„´

    let f = match f {
        Ok(file) => file,  // ì„±ê³µì ìœ¼ë¡œ íŒŒì¼ì´ ì—´ë¦´ ì‹œ file ë¦¬í„´
        Err(ref error) if error.kind() == ErrorKind::NotFound => {  // ErrorKind::NotFound variant ì‚¬ìš©ë¨
            match File::create("hello.txt") {  // íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° hello.txt íŒŒì¼ ìƒì„±
                Ok(fc) => fc,  // íŒŒì¼ ì„±ê³µì ìœ¼ë¡œ ìƒì„± ì‹œ fc ë°˜í™˜
                Err(e) => {  // ì˜¤ë¥˜ ë°œìƒ ì‹œ íŒ¨ë‹‰ ë§¤í¬ë¡œì™€ í•¨ê»˜ ì¢…ë£Œë¨
                    panic!(
                        "Tried to create file but there was a problem: {:?}",
                        e
                    )
                },
            }
        },
        Err(error) => {  // íŒŒì¼ ì—´ ë•Œ ì˜¤ë¥˜ ë°œìƒ ì‹œ íŒ¨ë‹‰ ë§¤í¬ë¡œì™€ í•¨ê»˜ ì¢…ë£Œ
            panic!(
                "There was a problem opening the file: {:?}",
                error
            )
        },
    };
}
```
* ```io::Error```
    * í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” êµ¬ì¡°ì²´
    * ```kind``` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ```io::ErrorKind``` ê°’ì„ ì–»ìŒ
    * ```io::ErrorKind```: ```io``` ì—°ì‚°ìœ¼ë¡œë¶€í„° ë°œìƒí•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ì—ëŸ¬ë¥¼ í‘œí˜„í•˜ëŠ” variantë¥¼ ê°€ì§„ ì—´ê±°í˜•
* *match guard*: ì¡°ê±´ë¬¸ ```if error.kind() == ErrorKind::NotFound```
    * ì¶”ê°€ ì¡°ê±´ë¬¸ ì—­í• 
    * ```match``` íŒ¨í„´ì—ì„œ ```ref```ì„ ì‚¬ìš©í•˜ì—¬ ```error```ì˜ ì†Œìœ ê¶Œì´ ê°€ë“œ ì¡°ê±´ë¬¸ìœ¼ë¡œ ì´ë™ë˜ì§€ ì•Šê³  ì°¸ì¡°ë§Œ ë˜ë„ë¡ í•¨!!
    * ```ref```ëŠ” ê°’ì„ ë§¤ì¹˜í•˜ì—¬ ê·¸ ì°¸ì¡°ìë¥¼ ì œê³µí•¨ (```&```ëŠ” ì°¸ì¡°ìë¥¼ ë§¤ì¹˜í•˜ê³  ê·¸ ê°’ ì œê³µ)
<br>

### ```unwrap```ê³¼ ```expect```
match êµ¬ë¬¸ê³¼ ë¹„ìŠ·í•œ ì—­í• ì„ í•˜ëŠ” ```unwrap``` ë©”ì†Œë“œ
* ```Result``` ê°’ìœ¼ë¡œ ```Ok``` ë˜ëŠ” ```Err```ì„ ë¦¬í„´
<br>

```rust
let f = File::open("hello.txt").unwrap();
```
<br>

```expect``` ë©”ì†Œë“œ
* ì—ëŸ¬ ë©”ì‹œì§€ì˜ ë‚´ìš©ì„ ì„¤ì •í•  ìˆ˜ ìˆì–´, íŒ¨ë‹‰ ë©”ì‹œì§€ë¥¼ íŒŒì•…í•˜ê¸° ì‰¬ì›Œì§
* unwrapì—ëŠ” ë¬¸ìì—´ì´ ì•ˆ ë“¤ì–´ê°
<br>

```rust
let f = File::open("hello.txt").expect("Failed to open hello.txt");
```  
<br>

### ì—ëŸ¬ ì „íŒŒí•˜ê¸°
ì‹¤íŒ¨ì˜ ê°€ëŠ¥ì„±ì´ ìˆëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•  ë•Œ, í•´ë‹¹ **í•¨ìˆ˜ ë‚´ì—ì„œ** ì²˜ë¦¬í•˜ëŠ” ëŒ€ì‹ , **ì—ëŸ¬ë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œ ìª½ìœ¼ë¡œ ë°˜í™˜**í•˜ì—¬ ì²˜ë¦¬
* ë” ë§ì€ ì •ë³´ì™€ ë¡œì§, ì œì–´ê¶Œ í™•ë³´
* ì‚¬ìš© ì˜ˆì‹œì™€ ì„¤ëª…
  <br>

  ```rust
  use std::io;
  use std::io::Read;
  use std::fs::File;
  
  fn read_username_from_file() -> Result<String, io::Error> {
      let f = File::open("hello.txt");
  
      let mut f = match f {
          Ok(file) => file,
          Err(e) => return Err(e),
      };
  
      let mut s = String::new();
  
      match f.read_to_string(&mut s) {
          Ok(_) => Ok(s),
          Err(e) => Err(e),  // í•¨ìˆ˜ ë§ˆì§€ë§‰ í‘œí˜„ì‹ì´ë¼ return ëª…ì‹œí•  í•„ìš” ì—†ìŒ
      }
  }
  ```
    * í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ì½”ë“œëŠ” ```String``` ë‹´ì€ ê°’ì„ ë¦¬í„´
    * ë¬¸ì œ ë°œìƒ ì‹œ ```Err``` ë¦¬í„´
    * ```File::open``` í•¨ìˆ˜ì™€ ```read_to_string``` ë©”ì†Œë“œ ë‘˜ ë‹¤ ```io::Error``` íƒ€ì…ì˜ ì—ëŸ¬ê°’ ë°˜í™˜
    * í•¨ìˆ˜ì˜ ë©”ì¸ì¸ ```File::open```ê°€ ì„±ê³µí•˜ë©´ íŒŒì¼ì„ ```f```ì— ì €ì¥í•˜ê³  ê³„ì† ì§„í–‰
    * ```read_to_string``` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ íŒŒì¼ì˜ ì½˜í…ì¸ ë¥¼ ì½ì–´ ```s```ì— ë„£ìŒ
        * ì„±ê³µ ì‹œ ```s``` ë‚´ì˜ íŒŒì¼ì„ ```Ok```ì— ì§‘ì–´ë„£ì–´ ë¦¬í„´
<br>

### ```?```: ì—ëŸ¬ë¥¼ ì „íŒŒí•˜ëŠ” ì—°ì‚°
* ```Result``` ê°’ ë’¤ì— ```?```ê°€ ìœ„ì¹˜í•´ìˆìŒìœ¼ë¡œì¨, ê°’ì´ ```Ok```ë¼ë©´ Ok ë‚´ ê°’ì„ ë°›ê³  ì´í›„ ì½”ë“œ ì§„í–‰ / ```Err```ë¼ë©´ ì „ì²´ í•¨ìˆ˜ë¡œë¶€í„° Err ë‚´ ê°’ ë°˜í™˜í•˜ëŠ” ì—­í• ì„ í•¨
* ë°˜í™˜ íƒ€ì…ì— ì •ì˜ëœ ì—ëŸ¬ íƒ€ì…ìœ¼ë¡œ ë³€í™˜ë˜ì–´, **ì—¬ëŸ¬ ì—ëŸ¬ë“¤ì„ í•˜ë‚˜ì˜ íŠ¹ì • ì—ëŸ¬ íƒ€ì…ìœ¼ë¡œ í†µì¼í•˜ì—¬ ì²˜ë¦¬**í•  ìˆ˜ ìˆìŒ
* ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ë¥¼ ì œê±°í•´ì£¼ê³  í•¨ìˆ˜ êµ¬í˜„ì„ ë‹¨ìˆœí™” 
* ì˜ˆì‹œ
  <br>

  ```rust
  let mut f = File::open("hello.txt")?;
  ```
* chainingì„ í™œìš©í•˜ì—¬ ì½”ë“œ ë‹¨ìˆœí™”í•˜ê¸° (ì•„ë˜ëŠ” ê°™ì€ ì—­í• ì˜ ë‘ ì½”ë“œì„)
  <br>

  ```rust
  let mut f = File::open("hello.txt")?;
  f.read_to_string(&mut s)?;
  ```
  ```rust
  File::open("hello.txt")?.read_to_string(&mut s)?;
  ```
* ```?```ì€ Resultë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì—ì„œë§Œ ì‚¬ìš©ë¨!!
    * ë°˜í™˜ íƒ€ì…ì´ ```()```ì¸ main í•¨ìˆ˜ì—ì„œëŠ” ì—ëŸ¬ ë°œìƒ
    * ìœ„ ì˜ˆì œë“¤ì˜ ë°˜í™˜ íƒ€ì…ì€ ```Result<String, io::Error>```ì˜€ìŒ
<br>

## 3. To panic!ğŸ¤¯ or Not to panic!ğŸ¤“
### ```panic!```ê³¼ ```Result```ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ê¸°
â”Œ ```panic!``` ì‚¬ìš© â†’ ì½”ë“œê°€ ë³µêµ¬ ë¶ˆê°€í•¨ì„ ì¸ì •í•˜ëŠ” ê²ƒ / í¬ë§ì´ ì•ˆ ë³´ì¼ ë•Œ ...<br>
â”‚<Br>
â”” ```Result``` ì‚¬ìš© â†’ ë°”ë¡œ ì½”ë“œì˜ ë³µêµ¬ ê°€ëŠ¥ì„±ì„ ë”°ì§€ê¸°ë³´ë‹¤ëŠ”, ì˜µì…˜ì„ ì œê³µí•˜ëŠ” ê²ƒ / ì˜ˆìƒì´ ë˜ëŠ” ê²½ìš°
* ì—ëŸ¬ ì²˜ë¦¬ ì½”ë“œ ê¸¸ê²Œ ì ê¸°ë³´ë‹¤ëŠ” ```unwrap``` ë˜ëŠ” ```expect``` ë©”ì†Œë“œ ì‚¬ìš©í•˜ê¸°!
* ì»´íŒŒì¼ëŸ¬ë¥¼ í†µí•´ ë¡œì§ì„ í•œ ë²ˆ ë” ê²€ì¦í•˜ê³  ì‹¶ë‹¤ë©´ ```unwrap```ì„ ì“°ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì„
<br>

### ìœ íš¨ì„±ì„ ìœ„í•œ ì»¤ìŠ¤í…€ íƒ€ì… ìƒì„±í•˜ê¸°
ì»¤ìŠ¤í…€ íƒ€ì…ì¸ ```Guess``` ì˜ˆì œë¥¼ í†µí•´ ì•Œì•„ë³´ê¸°

1. êµ¬ì¡°ì²´ ì„ ì–¸
2. íƒ€ì…ê³¼ ì¡°ê±´ì„ ëª…ì‹œí•œ í•¨ìˆ˜
3. ì¡°ê±´ì— ë”°ë¥¸ íŒ¨ë‹‰ ë§¤í¬ë¡œ ì‚¬ìš©

```rust
â•­â”€redzzzi in ~/firstrust/rustlang/example/unit09/src on masterâœ˜âœ˜âœ˜ 23-07-18 - 17:05:07
â•°â”€â  â µ cat main.rs
pub struct Guess {
    value: u32,
}

impl Guess {
    pub fn new(value: u32) -> Guess {
        if value < 1 || value > 100 {
            panic!("Guess value must be between 1 and 100, got {}.", value);
        }

        Guess {
            value
        }
    }

    pub fn value(&self) -> u32 {
        self.value
    }
}

fn main() {
    let guess1 = Guess::new(42);
    let guess2 = Guess::new(101);


    println!("Guess value: {}", guess1.value());
    println!("Guess value: {}", guess2.value());
}
```
```rust
â•­â”€redzzzi in ~/firstrust/rustlang/example/unit09/src on masterâœ˜âœ˜âœ˜ 23-07-18 - 17:05:09
â•°â”€â  â µ cargo run
   Compiling unit09 v0.1.0 (/home/redzzzi/firstrust/rustlang/example/unit09)
    Finished dev [unoptimized + debuginfo] target(s) in 0.09s
     Running `/home/redzzzi/firstrust/rustlang/example/unit09/target/debug/unit09`
thread 'main' panicked at 'Guess value must be between 1 and 100, got 101.', src/main.rs:8:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```


<br>
